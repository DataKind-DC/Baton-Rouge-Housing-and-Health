Vet_Total_Latino = rowSums(
select(., matches("Vet_Latino_(Male|Female)")),
na.rm = TRUE
),
# Calculate veteran age groups
Vet_Total_18_34 = rowSums(
select(., matches("Vet_(Male|Female)_18_34")),
na.rm = TRUE
),
Vet_Total_35_54 = rowSums(
select(., matches("Vet_(Male|Female)_35_54")),
na.rm = TRUE
),
Vet_Total_55_64 = rowSums(
select(., matches("Vet_(Male|Female)_55_64")),
na.rm = TRUE
),
Vet_Total_65_74 = rowSums(
select(., matches("Vet_(Male|Female)_65_74")),
na.rm = TRUE
),
Vet_Total_75_Plus = rowSums(
select(., matches("Vet_(Male|Female)_75_Plus")),
na.rm = TRUE
),
# Veteran Percentages
Pct_Veterans_Of_Adult_Pop = (Vet_Total_Veterans / Vet_Total_Pop_18_Plus) * 100,
Pct_Veterans_Male = (Vet_Male_Veterans / Vet_Total_Veterans) * 100,
Pct_Veterans_Female = (Vet_Female_Veterans / Vet_Total_Veterans) * 100,
# Veteran Race Percentages (of total veterans)
Pct_Veterans_White = (Vet_Total_White / Vet_Total_Veterans) * 100,
Pct_Veterans_Black = (Vet_Total_Black / Vet_Total_Veterans) * 100,
Pct_Veterans_Asian = (Vet_Total_Asian / Vet_Total_Veterans) * 100,
Pct_Veterans_Latino = (Vet_Total_Latino / Vet_Total_Veterans) * 100,
# Veteran Age Percentages (of total veterans)
Pct_Veterans_18_34 = (Vet_Total_18_34 / Vet_Total_Veterans) * 100,
Pct_Veterans_35_54 = (Vet_Total_35_54 / Vet_Total_Veterans) * 100,
Pct_Veterans_55_64 = (Vet_Total_55_64 / Vet_Total_Veterans) * 100,
Pct_Veterans_65_Plus = ((Vet_Total_65_74 + Vet_Total_75_Plus) / Vet_Total_Veterans) * 100
)
# ==============================================================================
# ADDITIONAL VETERAN CALCULATIONS - NEW DATA CATEGORIES
# ==============================================================================
final_wide_data <- final_wide_data %>%
mutate(
# Period of Service Aggregations (note: veterans can serve multiple periods)
Vet_Any_Post_9_11 = rowSums(
select(., matches("Vet_Gulf_War_Post_9_11")),
na.rm = TRUE
),
Vet_Any_Gulf_War = rowSums(
select(., matches("Vet_Gulf_War")),
na.rm = TRUE
),
Vet_Any_Vietnam = rowSums(
select(., matches("Vet_Vietnam")),
na.rm = TRUE
),
# Veteran Education Percentages
Pct_Vet_Ed_Less_Than_HS = if("Vet_Ed_Veteran_Less_Than_HS" %in% names(.)) {
(Vet_Ed_Veteran_Less_Than_HS / Vet_Ed_Veteran_Total) * 100
} else NA_real_,
Pct_Vet_Ed_HS_Grad = if("Vet_Ed_Veteran_HS_Grad" %in% names(.)) {
(Vet_Ed_Veteran_HS_Grad / Vet_Ed_Veteran_Total) * 100
} else NA_real_,
Pct_Vet_Ed_Some_College = if("Vet_Ed_Veteran_Some_College_AA" %in% names(.)) {
(Vet_Ed_Veteran_Some_College_AA / Vet_Ed_Veteran_Total) * 100
} else NA_real_,
Pct_Vet_Ed_Bachelors_Plus = if("Vet_Ed_Veteran_Bachelors_Plus" %in% names(.)) {
(Vet_Ed_Veteran_Bachelors_Plus / Vet_Ed_Veteran_Total) * 100
} else NA_real_,
# Veteran Poverty Rates (18-64)
Pct_Vet_18_64_In_Poverty = if("Vet_Pov_Veteran_18_64_Below_Poverty" %in% names(.)) {
(Vet_Pov_Veteran_18_64_Below_Poverty / Vet_Pov_Veteran_18_64) * 100
} else NA_real_,
# Veteran Poverty Rates (65+)
Pct_Vet_65_Plus_In_Poverty = if("Vet_Pov_Veteran_65_Plus_Below_Poverty" %in% names(.)) {
(Vet_Pov_Veteran_65_Plus_Below_Poverty / Vet_Pov_Veteran_65_Plus) * 100
} else NA_real_,
# Veteran Disability Rates (among those in poverty)
Pct_Vet_18_64_Poverty_With_Disability = if(all(c("Vet_Pov_Veteran_18_64_Below_Poverty_With_Disability", "Vet_Pov_Veteran_18_64_Below_Poverty") %in% names(.))) {
(Vet_Pov_Veteran_18_64_Below_Poverty_With_Disability / Vet_Pov_Veteran_18_64_Below_Poverty) * 100
} else NA_real_,
Pct_Vet_65_Plus_Poverty_With_Disability = if(all(c("Vet_Pov_Veteran_65_Plus_Below_Poverty_With_Disability", "Vet_Pov_Veteran_65_Plus_Below_Poverty") %in% names(.))) {
(Vet_Pov_Veteran_65_Plus_Below_Poverty_With_Disability / Vet_Pov_Veteran_65_Plus_Below_Poverty) * 100
} else NA_real_,
# Veteran Disability Rates (overall, among all veterans)
Pct_Vet_18_64_With_Disability = if(all(c("Vet_Pov_Veteran_18_64_Below_Poverty_With_Disability", "Vet_Pov_Veteran_18_64_At_Above_Poverty_With_Disability", "Vet_Pov_Veteran_18_64") %in% names(.))) {
((Vet_Pov_Veteran_18_64_Below_Poverty_With_Disability + Vet_Pov_Veteran_18_64_At_Above_Poverty_With_Disability) / Vet_Pov_Veteran_18_64) * 100
} else NA_real_,
Pct_Vet_65_Plus_With_Disability = if(all(c("Vet_Pov_Veteran_65_Plus_Below_Poverty_With_Disability", "Vet_Pov_Veteran_65_Plus_At_Above_Poverty_With_Disability", "Vet_Pov_Veteran_65_Plus") %in% names(.))) {
((Vet_Pov_Veteran_65_Plus_Below_Poverty_With_Disability + Vet_Pov_Veteran_65_Plus_At_Above_Poverty_With_Disability) / Vet_Pov_Veteran_65_Plus) * 100
} else NA_real_,
# Service-Connected Disability Rating Percentages
Pct_Vet_With_Service_Disability = if("Vet_Dis_Has_Rating" %in% names(.)) {
(Vet_Dis_Has_Rating / Vet_Dis_Rating_Total) * 100
} else NA_real_,
Pct_Vet_Disability_70_Plus = if("Vet_Dis_Rating_70_Plus_Pct" %in% names(.)) {
(Vet_Dis_Rating_70_Plus_Pct / Vet_Dis_Has_Rating) * 100
} else NA_real_
)
# Add employment percentages - aggregate B21005 age groups (18-34, 35-54, 55-64)
# Check if B21005 age-grouped variables exist
emp_vars_exist <- all(c(
"Vet_Emp_Veteran_18_34_Total", "Vet_Emp_Veteran_35_54_Total", "Vet_Emp_Veteran_55_64_Total",
"Vet_Emp_Veteran_18_34_In_Labor_Force", "Vet_Emp_Veteran_35_54_In_Labor_Force", "Vet_Emp_Veteran_55_64_In_Labor_Force",
"Vet_Emp_Veteran_18_34_Employed", "Vet_Emp_Veteran_35_54_Employed", "Vet_Emp_Veteran_55_64_Employed",
"Vet_Emp_Veteran_18_34_Unemployed", "Vet_Emp_Veteran_35_54_Unemployed", "Vet_Emp_Veteran_55_64_Unemployed"
) %in% names(final_wide_data))
if (emp_vars_exist) {
final_wide_data <- final_wide_data %>%
mutate(
# Aggregate across age groups (18-64)
Vet_Emp_Veteran_Total = Vet_Emp_Veteran_18_34_Total +
Vet_Emp_Veteran_35_54_Total +
Vet_Emp_Veteran_55_64_Total,
Vet_Emp_Veteran_In_Labor_Force = Vet_Emp_Veteran_18_34_In_Labor_Force +
Vet_Emp_Veteran_35_54_In_Labor_Force +
Vet_Emp_Veteran_55_64_In_Labor_Force,
Vet_Emp_Veteran_Employed = Vet_Emp_Veteran_18_34_Employed +
Vet_Emp_Veteran_35_54_Employed +
Vet_Emp_Veteran_55_64_Employed,
Vet_Emp_Veteran_Unemployed = Vet_Emp_Veteran_18_34_Unemployed +
Vet_Emp_Veteran_35_54_Unemployed +
Vet_Emp_Veteran_55_64_Unemployed,
# Calculate percentages
Pct_Veterans_Employed = (Vet_Emp_Veteran_Employed / Vet_Emp_Veteran_In_Labor_Force) * 100,
Pct_Veterans_Unemployed = (Vet_Emp_Veteran_Unemployed / Vet_Emp_Veteran_In_Labor_Force) * 100,
Pct_Veterans_In_Labor_Force = (Vet_Emp_Veteran_In_Labor_Force / Vet_Emp_Veteran_Total) * 100
)
cat("Employment data aggregated across age groups (18-34, 35-54, 55-64)\n")
} else {
cat("Warning: Employment data not available - skipping employment percentage calculations\n")
final_wide_data <- final_wide_data %>%
mutate(
Pct_Veterans_Employed = NA_real_,
Pct_Veterans_Unemployed = NA_real_,
Pct_Veterans_In_Labor_Force = NA_real_
)
}
# ==============================================================================
# SELECT KEY VARIABLES FOR OUTPUT
# ==============================================================================
cat("Selecting key variables for output...\n")
key_combined_data <- final_wide_data %>%
select(
# Geography
GEOID, NAME,
# Population
Total_Population, White_Alone, Black_Alone, Asian_Alone, Hispanic_Latino,
Pct_White, Pct_Black, Pct_Asian, Pct_Hispanic,
# Housing Supply
Total_Housing_Units, Occupied_Units, Vacant_Units, Pct_Vacant, Occupancy_Rate,
Owner_Occupied, Renter_Occupied, Pct_Owner_Occupied, Pct_Renter_Occupied,
# Structure Types
Single_Family_Detached, Single_Family_Attached, Multi_Family_All_Units,
Multi_Family_2_4_Units, Multi_Family_5_Plus_Units,
Multi_Family_10_Plus_Units, Multi_Family_20_Plus_Units,
Mobile_Home, Pct_Single_Family, Pct_Multi_Family_5_Plus,
# Unit Size
No_Bedroom, One_Bedroom, Two_Bedrooms, Three_Bedrooms, Four_Bedrooms, Five_Plus_Bedrooms,
Two_Plus_Bedroom_Units, Three_Plus_Bedroom_Units,
# Year Built
starts_with("Built_"),
# Households
Total_Households, Family_Households, Nonfamily_Living_Alone,
Households_With_Children_Under_18, Pct_Households_With_Children,
Total_Own_Children_Under_18, Children_In_Married_Couple_Families,
Children_In_Single_Mother_Families,
Large_Owner_Households_4_Plus, Large_Renter_Households_4_Plus,
Avg_Household_Size,
# Financial
Median_Home_Value, Median_Gross_Rent, Median_Household_Income,
Median_Income_Owner_Occupied, Median_Income_Renter_Occupied,
# Income Distribution - Individual Brackets
starts_with("Income_"),
# Income Distribution - Aggregated
Low_Income_Under_35K, Middle_Income_35K_100K, High_Income_100K_Plus,
# Poverty
Below_Poverty_Level, Children_Below_Poverty, Pct_Below_Poverty,
# Affordability
Rent_Burden_Ratio, Price_To_Income_Ratio,
# Rent Burden
High_Rent_Burden_30_Plus_Units, High_Rent_Burden_50_Plus_Units,
# ==============================================================================
# HOUSING VULNERABILITY METRICS
# ==============================================================================
# Age of Householder - Aging in Place (B25007)
any_of(c("Owner_Householder_15_24", "Owner_Householder_25_34", "Owner_Householder_35_44",
"Owner_Householder_45_54", "Owner_Householder_55_59", "Owner_Householder_60_64",
"Owner_Householder_65_74", "Owner_Householder_75_84", "Owner_Householder_85_Plus",
"Renter_Householder_15_24", "Renter_Householder_25_34", "Renter_Householder_35_44",
"Renter_Householder_45_54", "Renter_Householder_55_59", "Renter_Householder_60_64",
"Renter_Householder_65_74", "Renter_Householder_75_84", "Renter_Householder_85_Plus",
"Owner_Householder_65_Plus", "Owner_Householder_75_Plus",
"Pct_Owners_65_Plus", "Pct_Owners_75_Plus", "Pct_Owners_85_Plus")),
# Occupants Per Room - Overcrowding (B25014)
any_of(c("Owner_0_5_Or_Less_Per_Room", "Owner_0_51_To_1_Per_Room",
"Owner_1_01_To_1_5_Per_Room", "Owner_1_51_To_2_Per_Room", "Owner_2_Plus_Per_Room",
"Renter_0_5_Or_Less_Per_Room", "Renter_0_51_To_1_Per_Room",
"Renter_1_01_To_1_5_Per_Room", "Renter_1_51_To_2_Per_Room", "Renter_2_Plus_Per_Room",
"Owner_Overcrowded", "Renter_Overcrowded", "Total_Overcrowded",
"Pct_Owner_Overcrowded", "Pct_Renter_Overcrowded", "Pct_All_HH_Overcrowded")),
# Housing Cost Burden - Owners (B25091, B25106)
any_of(c("Owner_Cost_Burden_Less_20_Pct", "Owner_Cost_Burden_20_24_9_Pct", "Owner_Cost_Burden_25_29_9_Pct",
"Owner_Cost_Burden_30_34_9_Pct", "Owner_Cost_Burden_35_39_9_Pct",
"Owner_Cost_Burden_40_49_9_Pct", "Owner_Cost_Burden_50_Plus_Pct",
"Owner_Cost_Burden_30_Plus", "Owner_Cost_Burden_50_Plus",
"Pct_Owners_Cost_Burdened_30_Plus", "Pct_Owners_Cost_Burdened_50_Plus")),
# Housing Cost Burden - Renters (B25070, B25106)
any_of(c("Total_Renters_Cost_Burden_Universe",
"Rent_Burden_Less_20_Pct", "Rent_Burden_20_24_9_Pct", "Rent_Burden_25_29_9_Pct",
"Rent_Burden_30_34_9_Pct", "Rent_Burden_35_39_9_Pct",
"Rent_Burden_40_49_9_Pct", "Rent_Burden_50_Plus_Pct",
"Renter_Cost_Burden_30_Plus", "Renter_Cost_Burden_50_Plus",
"Pct_Renters_Cost_Burdened_30_Plus", "Pct_Renters_Cost_Burdened_50_Plus")),
# Combined Cost Burden (All Households)
any_of(c("Total_Cost_Burdened_30_Plus", "Total_Cost_Burdened_50_Plus",
"Pct_All_HH_Cost_Burdened_30_Plus", "Pct_All_HH_Cost_Burdened_50_Plus")),
# ==============================================================================
# DISABILITY DATA
# ==============================================================================
any_of(c("Total_With_Disability", "Total_No_Disability", "Pct_With_Disability")),
# ==============================================================================
# EDUCATION DATA
# ==============================================================================
# Total Population Education
any_of(c("Total_Pop_25_Plus", "Less_Than_HS", "HS_Grad_Or_Equivalent", "Some_College_Or_Associates",
"Bachelors_Degree", "Graduate_Or_Professional", "Total_Bachelors_Plus",
"Pct_Less_Than_HS", "Pct_HS_Grad", "Pct_Some_College", "Pct_Bachelors", "Pct_Graduate", "Pct_Bachelors_Plus")),
# Veteran vs Non-Veteran Education
any_of(c("Vet_Education_Less_Than_HS", "Vet_Education_HS_Grad", "Vet_Education_Some_College", "Vet_Education_Bachelors_Plus",
"NonVet_Education_Less_Than_HS", "NonVet_Education_HS_Grad", "NonVet_Education_Some_College", "NonVet_Education_Bachelors_Plus")),
# ==============================================================================
# HEALTH INSURANCE DATA
# ==============================================================================
# Overall Coverage Status
any_of(c("Total_Pop_Insurance_Universe",
"With_Health_Insurance", "No_Health_Insurance",
"Pct_With_Health_Insurance", "Pct_No_Health_Insurance")),
# Children's Insurance Coverage (Ages 0-18)
any_of(c("Total_Children_Under_18",
"Children_With_Insurance", "Children_No_Insurance",
"Pct_Children_With_Insurance", "Pct_Children_No_Insurance")),
# Insurance by Type (Counts)
any_of(c("With_Private_Insurance", "With_Public_Coverage",
"With_Employer_Insurance", "With_DirectPurchase_Insurance",
"With_Medicare", "With_Medicaid", "With_TRICARE", "With_VA_HealthCare")),
# Insurance by Type (Percentages)
any_of(c("Pct_With_Private_Insurance", "Pct_With_Public_Coverage",
"Pct_With_Employer_Insurance", "Pct_With_DirectPurchase_Insurance",
"Pct_With_Medicare", "Pct_With_Medicaid", "Pct_With_TRICARE", "Pct_With_VA_HealthCare")),
# Employment Status and Health Insurance
any_of(c("Employed_Total", "Employed_With_Health_Insurance", "Pct_Employed_With_Insurance",
"Unemployed_With_Health_Insurance", "Unemployed_With_Private_Insurance")),
# ==============================================================================
# DIGITAL ACCESS DATA
# ==============================================================================
any_of(c("HH_With_Internet", "HH_No_Internet", "HH_Broadband", "Pct_HH_With_Internet", "Pct_HH_With_Broadband",
"Has_Computer_And_Internet", "No_Computer", "Pct_HH_No_Computer")),
# ==============================================================================
# TRANSPORTATION DATA
# ==============================================================================
# Commute Times
any_of(c("Total_Workers_Commute_Universe", "Commute_Under_30_Min", "Commute_30_59_Min", "Commute_60_Plus_Min", "Work_At_Home",
"Pct_Commute_Under_30", "Pct_Commute_30_59", "Pct_Commute_60_Plus", "Pct_Work_At_Home")),
# Vehicle Availability
any_of(c("Owner_No_Vehicle", "Owner_1_Vehicle", "Owner_2_Vehicles", "Owner_3_Plus_Vehicles",
"Renter_No_Vehicle", "Renter_1_Vehicle", "Renter_2_Vehicles", "Renter_3_Plus_Vehicles",
"Total_No_Vehicle", "Total_With_Vehicle", "Pct_HH_No_Vehicle", "Pct_Owner_No_Vehicle", "Pct_Renter_No_Vehicle")),
# ==============================================================================
# HOUSING MOBILITY & STABILITY DATA
# ==============================================================================
# Year Moved In
any_of(c("Moved_In_2020_Later", "Moved_In_2010_2019", "Moved_In_2000_2009", "Moved_In_1990_1999", "Moved_In_Before_1990",
"Total_Moved_Since_2020", "Total_Moved_Since_2010", "Pct_Moved_Since_2020", "Pct_Moved_Since_2010")),
# Geographic Mobility
any_of(c("Same_House_1_Year_Ago", "Moved_Within_County", "Moved_From_Different_County",
"Moved_From_Different_State", "Moved_From_Abroad",
"Pct_Same_House_1_Year", "Pct_Moved_Within_County")),
# ==============================================================================
# ECONOMIC HARDSHIP DATA
# ==============================================================================
# Overall SNAP Receipt
any_of(c("Total_HH_SNAP_Universe",
"HH_Received_SNAP", "HH_No_SNAP",
"Pct_HH_SNAP", "Pct_HH_No_SNAP")),
# SNAP by Families with Children
any_of(c("Total_HH_With_Children",
"HH_SNAP_With_Children", "HH_No_SNAP_With_Children",
"Pct_HH_With_Children_On_SNAP")),
# SNAP by Poverty Status
any_of(c("HH_SNAP_Below_Poverty", "HH_SNAP_At_Above_Poverty",
"HH_No_SNAP_Below_Poverty", "HH_No_SNAP_At_Above_Poverty",
"Pct_HH_SNAP_Below_Poverty", "Pct_HH_SNAP_At_Above_Poverty")),
# Social Security, SSI, and Public Assistance
any_of(c("HH_With_Social_Security", "HH_No_Social_Security", "Pct_HH_With_Social_Security",
"HH_With_SSI", "HH_No_SSI", "Pct_HH_With_SSI",
"HH_With_Public_Assistance", "HH_No_Public_Assistance", "Pct_HH_Public_Assistance",
"HH_With_PublicAssist_Or_SNAP", "HH_No_PublicAssist_Or_SNAP", "Pct_HH_PublicAssist_Or_SNAP")),
# ==============================================================================
# MULTIGENERATIONAL & COMPLEX HOUSEHOLDS
# ==============================================================================
any_of(c("Multigenerational_Households", "Not_Multigenerational", "Pct_Multigenerational",
"Grandparents_Responsible_For_Grandchildren", "Pct_Grandparents_Caring")),
# Elderly Living Alone
any_of(c("Elderly_Living_Alone", "Pct_Elderly_Living_Alone")),
# ==============================================================================
# VETERANS DATA
# ==============================================================================
# Total Veterans
Vet_Total_Pop_18_Plus, Vet_Total_Veterans, Vet_Total_Non_Veterans,
Pct_Veterans_Of_Adult_Pop,
# Veterans by Gender
Vet_Male_Veterans, Vet_Female_Veterans,
Pct_Veterans_Male, Pct_Veterans_Female,
# Veterans by Age Group (from B21001)
Vet_Total_18_34, Vet_Total_35_54, Vet_Total_55_64,
Vet_Total_65_74, Vet_Total_75_Plus,
Pct_Veterans_18_34, Pct_Veterans_35_54, Pct_Veterans_55_64, Pct_Veterans_65_Plus,
# Veterans by Race/Ethnicity (Aggregated Totals)
Vet_Total_White, Vet_Total_Black, Vet_Total_Asian, Vet_Total_Latino,
Pct_Veterans_White, Pct_Veterans_Black, Pct_Veterans_Asian, Pct_Veterans_Latino,
# Period of Service (B21002 - Veterans can serve multiple periods, totals may not sum)
any_of(c("Vet_Period_Total", "Vet_Any_Post_9_11", "Vet_Any_Gulf_War", "Vet_Any_Vietnam")),
starts_with("Vet_Gulf_War"), starts_with("Vet_Vietnam"),
starts_with("Vet_Korean"), starts_with("Vet_WWII"), starts_with("Vet_Between"),
any_of(c("Vet_Pre_WWII_Only")),
# Veteran Educational Attainment (B21003)
any_of(c("Vet_Ed_Total_Pop_25_Plus", "Vet_Ed_Veteran_Total",
"Vet_Ed_Veteran_Less_Than_HS", "Vet_Ed_Veteran_HS_Grad",
"Vet_Ed_Veteran_Some_College_AA", "Vet_Ed_Veteran_Bachelors_Plus",
"Pct_Vet_Ed_Less_Than_HS", "Pct_Vet_Ed_HS_Grad",
"Pct_Vet_Ed_Some_College", "Pct_Vet_Ed_Bachelors_Plus")),
# Veteran Income (B21004)
any_of(c("Vet_Median_Income_Total", "Vet_Median_Income_Veteran_Total",
"Vet_Median_Income_Veteran_Male", "Vet_Median_Income_Veteran_Female",
"Vet_Median_Income_NonVeteran_Total", "Vet_Median_Income_NonVeteran_Male",
"Vet_Median_Income_NonVeteran_Female")),
# Veteran Employment (B21005 - Aggregated across age groups 18-64)
any_of(c("Vet_Emp_Total_18_64", "Vet_Emp_Veteran_Total",
"Vet_Emp_Veteran_In_Labor_Force", "Vet_Emp_Veteran_Employed",
"Vet_Emp_Veteran_Unemployed",
"Pct_Veterans_Employed", "Pct_Veterans_Unemployed",
"Pct_Veterans_In_Labor_Force")),
# Veteran Poverty Status (C21007)
any_of(c("Vet_Pov_Veteran_18_64", "Vet_Pov_Veteran_18_64_Below_Poverty",
"Vet_Pov_Veteran_65_Plus", "Vet_Pov_Veteran_65_Plus_Below_Poverty",
"Pct_Vet_18_64_In_Poverty", "Pct_Vet_65_Plus_In_Poverty")),
# Veteran Disability Status from Poverty Table (C21007)
any_of(c("Vet_Pov_Veteran_18_64_Below_Poverty_With_Disability",
"Vet_Pov_Veteran_18_64_At_Above_Poverty_With_Disability",
"Vet_Pov_Veteran_65_Plus_Below_Poverty_With_Disability",
"Vet_Pov_Veteran_65_Plus_At_Above_Poverty_With_Disability",
"Pct_Vet_18_64_With_Disability", "Pct_Vet_65_Plus_With_Disability",
"Pct_Vet_18_64_Poverty_With_Disability", "Pct_Vet_65_Plus_Poverty_With_Disability")),
# Service-Connected Disability Ratings (B21100/C21100)
any_of(c("Vet_Dis_Rating_Total", "Vet_Dis_No_Rating", "Vet_Dis_Has_Rating",
"Vet_Dis_Rating_0_Pct", "Vet_Dis_Rating_10_20_Pct",
"Vet_Dis_Rating_30_40_Pct", "Vet_Dis_Rating_50_60_Pct",
"Vet_Dis_Rating_70_Plus_Pct",
"Pct_Vet_With_Service_Disability", "Pct_Vet_Disability_70_Plus"))
)
# ==============================================================================
# SPATIAL ANALYSIS
# ==============================================================================
cat("Fetching tract geometries for spatial analysis...\n")
tracts_geometry <- tryCatch({
get_acs(
geography = "tract",
variables = "B01003_001",
state = state,
county = county,
year = 2023,
survey = "acs5",
geometry = TRUE
)
}, error = function(e) {
cat("Warning: Could not fetch tract geometries\n")
NULL
})
# Join housing data with geometries
if (!is.null(tracts_geometry)) {
housing_with_geometry <- tracts_geometry %>%
select(GEOID, geometry) %>%
left_join(key_combined_data, by = "GEOID")
cat("Successfully joined data with tract geometries\n")
# Set up coordinate reference systems
wgs84_crs <- 4326
projected_crs <- 32616  # UTM Zone 16N for Cook County
# Transform to projected CRS for area calculations
tracts_projected <- housing_with_geometry %>%
st_transform(crs = projected_crs)
# Calculate spatial metrics
tracts_with_density <- tracts_projected %>%
mutate(
tract_area_sqft = as.numeric(st_area(.)),
tract_area_sqmi = tract_area_sqft / 27878400,
tract_area_acres = tract_area_sqft / 43560,
# Density calculations
housing_units_per_sqmi = Total_Housing_Units / tract_area_sqmi,
housing_units_per_acre = Total_Housing_Units / tract_area_acres,
population_per_sqmi = Total_Population / tract_area_sqmi,
population_per_acre = Total_Population / tract_area_acres,
# Veteran density
veterans_per_sqmi = Vet_Total_Veterans / tract_area_sqmi,
veterans_per_1000_pop = (Vet_Total_Veterans / Total_Population) * 1000,
# Gross and net housing density
gross_housing_density_per_sqmi = housing_units_per_sqmi,
net_housing_density_per_sqmi = Occupied_Units / tract_area_sqmi
)
# Transform back to WGS84 for output
final_tract_data <- tracts_with_density %>%
st_transform(crs = wgs84_crs)
cat("Spatial calculations complete\n")
} else {
cat("Skipping spatial calculations - geometry not available\n")
final_tract_data <- key_combined_data
}
# ==============================================================================
# OUTPUT FILES
# ==============================================================================
cat("\n", paste(rep("=", 70), collapse = ""), "\n")
cat("CREATING OUTPUT FILES\n")
cat(paste(rep("=", 70), collapse = ""), "\n")
# Output tract-level data (CSV - no geometry)
if (!is.null(final_tract_data)) {
enhanced_tract_data <- final_tract_data
if ("geometry" %in% names(enhanced_tract_data)) {
enhanced_tract_data <- st_drop_geometry(enhanced_tract_data)
}
write.csv(enhanced_tract_data, "Cook_County_Housing_Veterans_Tract_2023.csv", row.names = FALSE)
cat("✓ Created: Cook_County_Housing_Veterans_Tract_2023.csv\n")
}
# Output tract-level data with geometry (GeoJSON)
if (!is.null(final_tract_data) && "geometry" %in% names(final_tract_data)) {
st_write(final_tract_data, "Cook_County_Housing_Veterans_Tract_2023.geojson",
driver = "GeoJSON", delete_dsn = TRUE)
cat("✓ Created: Cook_County_Housing_Veterans_Tract_2023.geojson\n")
}
# ==============================================================================
# SUMMARY REPORT
# ==============================================================================
cat("\n", paste(rep("=", 70), collapse = ""), "\n")
cat("COOK COUNTY HOUSING & VETERANS DATA SUMMARY\n")
cat(paste(rep("=", 70), collapse = ""), "\n\n")
if (exists("enhanced_tract_data")) {
cat("Census Tracts:", nrow(enhanced_tract_data), "\n")
cat("Total Variables:", ncol(enhanced_tract_data), "\n\n")
# Housing Summary
housing_summary <- enhanced_tract_data %>%
summarise(
total_housing_units = sum(Total_Housing_Units, na.rm = TRUE),
total_population = sum(Total_Population, na.rm = TRUE),
avg_median_home_value = mean(Median_Home_Value, na.rm = TRUE),
avg_median_rent = mean(Median_Gross_Rent, na.rm = TRUE)
)
cat("HOUSING OVERVIEW:\n")
cat("  Total Housing Units:", format(housing_summary$total_housing_units, big.mark = ","), "\n")
cat("  Total Population:", format(housing_summary$total_population, big.mark = ","), "\n")
cat("  Avg Median Home Value: $", format(round(housing_summary$avg_median_home_value), big.mark = ","), "\n", sep = "")
cat("  Avg Median Rent: $", format(round(housing_summary$avg_median_rent), big.mark = ","), "\n\n", sep = "")
# Veterans Summary
veteran_summary <- enhanced_tract_data %>%
summarise(
total_veterans = sum(Vet_Total_Veterans, na.rm = TRUE),
total_adult_pop = sum(Vet_Total_Pop_18_Plus, na.rm = TRUE),
pct_veterans = mean(Pct_Veterans_Of_Adult_Pop, na.rm = TRUE),
male_veterans = sum(Vet_Male_Veterans, na.rm = TRUE),
female_veterans = sum(Vet_Female_Veterans, na.rm = TRUE),
white_veterans = sum(Vet_Total_White, na.rm = TRUE),
black_veterans = sum(Vet_Total_Black, na.rm = TRUE),
asian_veterans = sum(Vet_Total_Asian, na.rm = TRUE),
latino_veterans = sum(Vet_Total_Latino, na.rm = TRUE)
)
cat("VETERANS OVERVIEW:\n")
cat("  Total Veterans:", format(veteran_summary$total_veterans, big.mark = ","), "\n")
cat("  Adult Population (18+):", format(veteran_summary$total_adult_pop, big.mark = ","), "\n")
cat("  Avg % Veterans:", round(veteran_summary$pct_veterans, 2), "%\n\n")
cat("  By Gender:\n")
cat("    Male:", format(veteran_summary$male_veterans, big.mark = ","),
"(", round(veteran_summary$male_veterans / veteran_summary$total_veterans * 100, 1), "%)\n", sep = "")
cat("    Female:", format(veteran_summary$female_veterans, big.mark = ","),
"(", round(veteran_summary$female_veterans / veteran_summary$total_veterans * 100, 1), "%)\n\n", sep = "")
cat("  By Race/Ethnicity:\n")
cat("    White:", format(veteran_summary$white_veterans, big.mark = ","),
"(", round(veteran_summary$white_veterans / veteran_summary$total_veterans * 100, 1), "%)\n", sep = "")
cat("    Black:", format(veteran_summary$black_veterans, big.mark = ","),
"(", round(veteran_summary$black_veterans / veteran_summary$total_veterans * 100, 1), "%)\n", sep = "")
cat("    Asian:", format(veteran_summary$asian_veterans, big.mark = ","),
"(", round(veteran_summary$asian_veterans / veteran_summary$total_veterans * 100, 1), "%)\n", sep = "")
cat("    Latino:", format(veteran_summary$latino_veterans, big.mark = ","),
"(", round(veteran_summary$latino_veterans / veteran_summary$total_veterans * 100, 1), "%)\n\n", sep = "")
# Density summary (if spatial data available)
if ("housing_units_per_sqmi" %in% names(enhanced_tract_data)) {
density_summary <- enhanced_tract_data %>%
summarise(
avg_housing_density = mean(housing_units_per_sqmi, na.rm = TRUE),
max_housing_density = max(housing_units_per_sqmi, na.rm = TRUE),
avg_population_density = mean(population_per_sqmi, na.rm = TRUE),
avg_veteran_density = mean(veterans_per_sqmi, na.rm = TRUE)
)
cat("DENSITY METRICS:\n")
cat("  Avg Housing Density:", round(density_summary$avg_housing_density, 1), "units/sq mi\n")
cat("  Max Housing Density:", round(density_summary$max_housing_density, 1), "units/sq mi\n")
cat("  Avg Population Density:", round(density_summary$avg_population_density, 1), "people/sq mi\n")
cat("  Avg Veteran Density:", round(density_summary$avg_veteran_density, 2), "veterans/sq mi\n\n")
}
}
cat(paste(rep("=", 70), collapse = ""), "\n")
cat("DATA PULL COMPLETE!\n")
cat(paste(rep("=", 70), collapse = ""), "\n")
